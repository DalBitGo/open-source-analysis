# claude-agent-sdk-python Analysis

**ì›ë³¸**: https://github.com/anthropics/claude-agent-sdk-python
**ì–¸ì–´**: Python
**Stars**: 2,334 â­
**ë¶„ì„ì¼**: 2025-01-09
**ë²„ì „**: 0.1.1

---

## ğŸ“– í”„ë¡œì íŠ¸ ê°œìš”

**Claude Agent SDK for Python**ì€ Anthropicì˜ ê³µì‹ Python SDKë¡œ, Claude Codeì™€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•œ í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥
- **ê°„ë‹¨í•œ ì¿¼ë¦¬ ì¸í„°í˜ì´ìŠ¤** (`query()`): ë‹¨ë°©í–¥ ì§ˆì˜-ì‘ë‹µ
- **ì–‘ë°©í–¥ í´ë¼ì´ì–¸íŠ¸** (`ClaudeSDKClient`): ì§€ì†ì ì¸ ëŒ€í™” ì„¸ì…˜
- **ì»¤ìŠ¤í…€ ë„êµ¬ ì§€ì›**: Python í•¨ìˆ˜ë¥¼ MCP ì„œë²„ë¡œ ì œê³µ
- **í›… ì‹œìŠ¤í…œ**: Claude ì—ì´ì „íŠ¸ ë£¨í”„ì— ëŒ€í•œ í”„ë¡œê·¸ë˜ë° ê°€ëŠ¥í•œ ì œì–´
- **íƒ€ì… ì•ˆì „ì„±**: ì™„ì „í•œ íƒ€ì… íŒíŠ¸ ë° mypy strict ëª¨ë“œ ì§€ì›

### ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€
1. **AI ì—ì´ì „íŠ¸ í†µí•©**: ì• í”Œë¦¬ì¼€ì´ì…˜ì— Claude ì—ì´ì „íŠ¸ ì„ë² ë”©
2. **ìë™í™” ì›Œí¬í”Œë¡œìš°**: í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì‘ì—… ìë™í™”
3. **ì»¤ìŠ¤í…€ ë„êµ¬ ê°œë°œ**: Python í•¨ìˆ˜ë¥¼ Claudeê°€ ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ë¡œ ì œê³µ
4. **ì—ì´ì „íŠ¸ ì œì–´**: í›…ì„ í†µí•œ ì„¸ë°€í•œ ë™ì‘ ì œì–´

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### ê³„ì¸µ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Public API Layer                  â”‚
â”‚  (query, ClaudeSDKClient, types)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Internal Implementation           â”‚
â”‚  (_internal/client, _internal/query)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Transport Layer                   â”‚
â”‚  (subprocess_cli.py)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Claude Code CLI                   â”‚
â”‚  (External Node.js Process)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸
- **query()**: ë‹¨ìˆœí•œ ë¹„ë™ê¸° ì¿¼ë¦¬ í•¨ìˆ˜
- **ClaudeSDKClient**: ìƒíƒœ ìœ ì§€ í´ë¼ì´ì–¸íŠ¸ í´ë˜ìŠ¤
- **Types**: ë©”ì‹œì§€, ì˜µì…˜, ë¸”ë¡ íƒ€ì… ì •ì˜
- **Transport**: Claude Code CLIì™€ì˜ í†µì‹  ê´€ë¦¬
- **Message Parser**: JSON ìŠ¤íŠ¸ë¦¼ íŒŒì‹±

---

## ğŸ” ë¶„ì„ ìš”ì•½

### Operability (ìš´ì˜ì„±) - â­â­â­â­â˜†

**ê°•ì :**
- âœ… **ëª…í™•í•œ ì—ëŸ¬ íƒ€ì… ê³„ì¸µ**: `ClaudeSDKError` ê¸°ë°˜ 6ê°€ì§€ êµ¬ì²´ì  ì—ëŸ¬
- âœ… **ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¬ë°**: `AsyncIterator`ë¡œ ì‹¤ì‹œê°„ ì‘ë‹µ ì²˜ë¦¬
- âœ… **ì„œë¸Œí”„ë¡œì„¸ìŠ¤ ê´€ë¦¬**: ìë™ ì¬ì‹œì‘, íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬
- âœ… **íƒ€ì… ì•ˆì „ì„±**: mypy strict ëª¨ë“œ, ì™„ì „í•œ íƒ€ì… íŒíŠ¸

**ê°œì„ ì :**
- âš ï¸ ë¡œê¹… ì‹œìŠ¤í…œì´ ëª…ì‹œì ìœ¼ë¡œ ë³´ì´ì§€ ì•ŠìŒ
- âš ï¸ ë©”íŠ¸ë¦­/ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ ë¶€ì¬

### Simplicity (ë‹¨ìˆœì„±) - â­â­â­â­â­

**ê°•ì :**
- âœ… **ìµœì†Œì£¼ì˜ API**: `query()` í•˜ë‚˜ë¡œ ì‹œì‘ ê°€ëŠ¥
- âœ… **ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬**: Public API â†” Internal â†” Transport
- âœ… **ì¼ê´€ëœ ë„¤ì´ë°**: `ClaudeAgentOptions`, `ClaudeSDKClient` ë“±
- âœ… **ì ì§„ì  ë³µì¡ë„**: query() â†’ ClaudeSDKClient â†’ ì»¤ìŠ¤í…€ ë„êµ¬ â†’ í›…

**íŠ¹ì§•:**
- ì´ˆë³´ì: 3ì¤„ ì½”ë“œë¡œ ì‹œì‘
- ê³ ê¸‰ ì‚¬ìš©ì: ì„¸ë°€í•œ ì œì–´ ê°€ëŠ¥

### Evolvability (ë°œì „ì„±) - â­â­â­â­â­

**ê°•ì :**
- âœ… **ì¸í„°í˜ì´ìŠ¤ ì¶”ìƒí™”**: Transport ë ˆì´ì–´ êµì²´ ê°€ëŠ¥
- âœ… **í™•ì¥ ê°€ëŠ¥í•œ ë„êµ¬ ì‹œìŠ¤í…œ**: MCP ì„œë²„ í‘œì¤€ í™œìš©
- âœ… **í›… ì•„í‚¤í…ì²˜**: ê¸°ëŠ¥ ì¶”ê°€ ì—†ì´ ë™ì‘ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- âœ… **íƒ€ì… í™•ì¥ì„±**: TypedDict, Protocol í™œìš©

**ì„¤ê³„ ê²°ì •:**
- Public APIì™€ Internal ëª…í™•íˆ ë¶„ë¦¬ (`_internal/`)
- External MCP + SDK MCP í˜¼ìš© ê°€ëŠ¥
- ì„œë¸Œí”„ë¡œì„¸ìŠ¤ ê¸°ë°˜ â†’ ë‹¤ë¥¸ Claude êµ¬í˜„ì²´ë¡œ êµì²´ ê°€ëŠ¥

---

## ğŸ“Š í”„ë¡œì íŠ¸ í†µê³„

### ì½”ë“œ êµ¬ì¡°
- **í•µì‹¬ ëª¨ë“ˆ**: 9ê°œ Python íŒŒì¼
- **ì˜ˆì œ**: 11ê°œ
- **í…ŒìŠ¤íŠ¸**: E2E 7ê°œ + ìœ ë‹› í…ŒìŠ¤íŠ¸

### ì˜ì¡´ì„±
```python
dependencies = [
    "anyio>=4.0.0",           # ë¹„ë™ê¸° I/O ì¶”ìƒí™”
    "typing_extensions",       # íƒ€ì… íŒíŠ¸ ì§€ì›
    "mcp>=0.1.0",             # MCP í”„ë¡œí† ì½œ
]
```

### ì§€ì› í™˜ê²½
- Python 3.10+
- anyio ê¸°ë°˜ (asyncio + trio ì§€ì›)
- Node.js (Claude Code CLI í•„ìš”)

---

## ğŸ¯ ì£¼ìš” ë°œê²¬ ì‚¬í•­

### 1. **ê³„ì¸µì  ì¶”ìƒí™”**
- Public APIëŠ” ê·¹ë„ë¡œ ë‹¨ìˆœ
- ë³µì¡ì„±ì€ `_internal/`ì— ìº¡ìŠí™”
- ì‚¬ìš©ìëŠ” ë‚´ë¶€ êµ¬í˜„ ëª°ë¼ë„ ë¨

### 2. **í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  (IPC) íŒ¨í„´**
- Python â†” Node.js (Claude Code CLI)
- JSON Lines í”„ë¡œí† ì½œ
- ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¬ë°

### 3. **MCP í”„ë¡œí† ì½œ í™œìš©**
- í‘œì¤€ í”„ë¡œí† ì½œë¡œ ë„êµ¬ í™•ì¥
- In-process SDK MCP ì„œë²„ (í˜ì‹ !)
- External MCP ì„œë²„ì™€ í˜¼ìš© ê°€ëŠ¥

### 4. **íƒ€ì… ì•ˆì „ì„± ìš°ì„  ì„¤ê³„**
- mypy strict ëª¨ë“œ
- TypedDictë¡œ ëŸ°íƒ€ì„ íƒ€ì… ì²´í¬ ë¶ˆí•„ìš”
- IDE ìë™ì™„ì„± ì§€ì›

### 5. **ì ì§„ì  ê³µê°œ (Progressive Disclosure)**
```python
# ë ˆë²¨ 1: ê¸°ë³¸ ì¿¼ë¦¬
query(prompt="Hello")

# ë ˆë²¨ 2: ì˜µì…˜ ì¶”ê°€
query(prompt="Hello", options=ClaudeAgentOptions(...))

# ë ˆë²¨ 3: ì–‘ë°©í–¥ ëŒ€í™”
ClaudeSDKClient(...)

# ë ˆë²¨ 4: ì»¤ìŠ¤í…€ ë„êµ¬
create_sdk_mcp_server(tools=[...])

# ë ˆë²¨ 5: í›…ìœ¼ë¡œ ì œì–´
hooks={"PreToolUse": [...]}
```

---

## ğŸ”§ ì„¤ê³„ íŒ¨í„´

### 1. **Facade Pattern**
- `query()`, `ClaudeSDKClient`ê°€ ë³µì¡í•œ ë‚´ë¶€ êµ¬í˜„ ìˆ¨ê¹€

### 2. **Adapter Pattern**
- `subprocess_cli.py`: Node.js CLI â†” Python ì–´ëŒ‘í„°

### 3. **Factory Pattern**
- `create_sdk_mcp_server()`: MCP ì„œë²„ ìƒì„±

### 4. **Iterator Pattern**
- `AsyncIterator[Message]`: ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ

### 5. **Hook Pattern**
- í™•ì¥ í¬ì¸íŠ¸ ì œê³µ (PreToolUse, PostToolUse ë“±)

---

## ğŸ’¡ ë°°ìš¸ ì 

### 1. SDK ì„¤ê³„ ì›ì¹™
- **ê°„ë‹¨í•œ ì‹œì‘, ë³µì¡í•œ ì˜µì…˜**
- Public/Internal ëª…í™•í•œ ë¶„ë¦¬
- íƒ€ì… ì•ˆì „ì„± ìš°ì„ 

### 2. í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ 
- JSON Lines í”„ë¡œí† ì½œ
- ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¬ë°
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œì‘

### 3. í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜
- MCP í‘œì¤€ í™œìš©
- í›… ì‹œìŠ¤í…œ
- In-process ìµœì í™” (SDK MCP)

### 4. ê°œë°œì ê²½í—˜ (DX)
- 3ì¤„ë¡œ ì‹œì‘ ê°€ëŠ¥
- í’ë¶€í•œ ì˜ˆì œ (11ê°œ)
- ì™„ì „í•œ íƒ€ì… íŒíŠ¸

---

## ğŸš€ ë‹¤ìŒ ë¶„ì„ ë‹¨ê³„

1. **_architecture.md**: ì „ì²´ ì•„í‚¤í…ì²˜ ì‹¬ì¸µ ë¶„ì„
2. **types.py.md**: íƒ€ì… ì‹œìŠ¤í…œ ìƒì„¸ ë¶„ì„
3. **client.py.md**: ClaudeSDKClient êµ¬ì¡°
4. **query.py.md**: query() í•¨ìˆ˜ êµ¬í˜„
5. **_internal/transport/subprocess_cli.py.md**: IPC ë©”ì»¤ë‹ˆì¦˜
6. **_insights.md**: ë°œê²¬í•œ íŒ¨í„´ ë° ê°œì„ ì 

---

**ë¶„ì„ ì‘ì„±**: Claude Code
**ë¶„ì„ í”„ë ˆì„ì›Œí¬**: Operability, Simplicity, Evolvability
